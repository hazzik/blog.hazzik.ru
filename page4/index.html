<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Hazzik's blog &middot; 
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="tag-cloud">
      <a href="/tag/dot-net" class="set-4">.NET</a> <a href="/tag/dot-net-3-dot-5" class="set-1">.NET 3.5</a> <a href="/tag/dot-netconf" class="set-1">.netconf</a> <a href="/tag/blog" class="set-1">Blog</a> <a href="/tag/db" class="set-2">DB</a> <a href="/tag/ddd" class="set-1">DDD</a> <a href="/tag/dropdown" class="set-1">DropDown</a> <a href="/tag/entityframework" class="set-1">EntityFramework</a> <a href="/tag/git" class="set-1">Git</a> <a href="/tag/headjs" class="set-1">HeadJS</a> <a href="/tag/hollywar" class="set-1">HollyWar</a> <a href="/tag/javasript" class="set-1">JavaSript</a> <a href="/tag/orm" class="set-1">ORM</a> <a href="/tag/oracle" class="set-1">Oracle</a> <a href="/tag/phpunit" class="set-1">PHPUnit</a> <a href="/tag/performance" class="set-1">Performance</a> <a href="/tag/postgresql" class="set-1">PostgreSQL</a> <a href="/tag/requirejs" class="set-1">RequireJS</a> <a href="/tag/resources" class="set-1">Resources</a> <a href="/tag/seo" class="set-1">SEO</a> <a href="/tag/sockets" class="set-1">Sockets</a> <a href="/tag/subversion" class="set-1">Subversion</a> <a href="/tag/tree-like-structures" class="set-1">Tree-like structures</a> <a href="/tag/version-control" class="set-1">Version Control</a> <a href="/tag/asp-dot-net" class="set-2">asp.net</a> <a href="/tag/asp-dot-net-mvc" class="set-5">asp.net mvc</a> <a href="/tag/bootstrapping" class="set-1">bootstrapping</a> <a href="/tag/business-rules" class="set-1">business rules</a> <a href="/tag/datepicker" class="set-1">datepicker</a> <a href="/tag/dotnetconf" class="set-1">dotnetconf</a> <a href="/tag/google-sitemap" class="set-1">google sitemap</a> <a href="/tag/jquery-ui" class="set-1">jquery-ui</a> <a href="/tag/lambda-expression" class="set-1">lambda expression</a> <a href="/tag/linq" class="set-1">linq</a> <a href="/tag/llblgen" class="set-1">llblgen</a> <a href="/tag/msil" class="set-1">msil</a> <a href="/tag/mvc" class="set-1">mvc</a> <a href="/tag/mvcextensions" class="set-4">mvcextensions</a> <a href="/tag/network" class="set-1">network</a> <a href="/tag/nhibernate" class="set-3">nhibernate</a> <a href="/tag/phalanger" class="set-1">phalanger</a> <a href="/tag/php" class="set-1">php</a> <a href="/tag/questions" class="set-1">questions</a> <a href="/tag/reflection" class="set-1">reflection</a> <a href="/tag/silverlight" class="set-1">silverlight</a> <a href="/tag/sitemap-dot-xml" class="set-1">sitemap.xml</a> <a href="/tag/xunit" class="set-1">xUnit</a> <a href="/tag/asinkhronnyi-vvod-vyvod" class="set-1">Асинхронный ввод-вывод</a> <a href="/tag/voprosy" class="set-2">Вопросы</a> <a href="/tag/khranimyie-protsiedury" class="set-1">Хранимые процедуры</a> <a href="/tag/poiskovaia-optimizatsiia" class="set-1">поисковая оптимизация</a>
    </div>
    <div class="sidebar-about">

      <h1><a href="/">Hazzik's blog</a></h1>
      <p class="lead"><a href="/"></a></p>

    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item active">
        <a href="/">Главная</a>
      </li>

      

      
      
            <li class="sidebar-nav-item">
              <a href="/about/">Обо мне</a>
            </li>
      
    </ul>
    <ul class="sidebar-social">
      <li class="sidebar-social-item"><a href="http://twitter.com/hazzik"><i class="fa fa-twitter"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://github.com/hazzik"><i class="fa fa-github"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://linkedin.com/in/hazzik"><i class="fa fa-linkedin"></i></a></li>
    </ul>

    <p>&copy; 2014. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="posts">
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://github.com/hazzik/blog.hazzik.ru/edit/master/_posts/tumblr/2012-03-18-orm-vs-stored-procedures.html"><i class="fa fa-edit"></i></a>
      <a href="/2012/03/18/orm-vs-stored-procedures/">
        ORM vs. Хранимые процедуры
      </a>
    </h1>
    <ul class="post-info">
      <li><i class="fa fa-calendar"></i> 18 Mar 2012</li>
      <li><i class="fa fa-tags"></i> <a href="/tag/orm" rel="tag">ORM</a>, <a href="/tag/khranimyie-protsiedury" rel="tag">Хранимые процедуры</a>, <a href="/tag/nhibernate" rel="tag">NHibernate</a>, <a href="/tag/hollywar" rel="tag">HollyWar</a> </li>
      <li><i class="fa fa-comments"></i> <a href="/2012/03/18/orm-vs-stored-procedures/#disqus_thread" data-disqus-identifier="/2012/03/18/orm-vs-stored-procedures/">0 комментариев</a></li>
    </ul>
    <p><img src="http://richardtaylor.me/wp-content/uploads/2011/01/jpg_vs_png-280x3001.png" alt="png vs jpeg" style="float:right"/>Мой <a href="http://www.byndyu.ru">коллега</a>, позавчера в очередной раз у себя в блоге <a href="http://blog.byndyu.ru/2012/03/blog-post.html">поднял этот больной вопрос</a>.</p>

<p>Для себя я уже давно определился с тем, какой подход использовать, и в этом посте я хочу рассказать вам почему я выбрал именно этот подход.</p>

<!-- more -->

<h3><a href="http://en.wikipedia.org/wiki/Stored_procedure">Хранимые процедуры</a></h3>

<p>Защитники хранимых процедур приводят в пример два плюса их использования:</p>

<ol><li><p>Хранимые процедуры компилируются и за счет этого исполняются быстрее, чем обычные SQL скрипты (как написанные вручную, так и сгенерированные ORM).</p></li>
<li><p>Если вам необходимо обработать много данных и вернуть мало результатов, то без хранимых процедур вам не обойтись.</p></li>
</ol><p>Я не буду спорить с этими достоинствами, т.к. я с ними полностью согласен.</p>

<p>Но практически все защитники подхода с хранимыми процедурами молчат о недостатках:</p>

<ol><li><p><a href="http://en.wikipedia.org/wiki/RDBMS">RDBMS</a> не выполняют контроль целостности кода хранимой процедуры при изменении схемы данных, от которых хранимая процедура зависит.</p>

<p>О том, что моя хранимая процедура сломалась я смогу узнать только при попытке ее выполнить. Но что, если уже поздно и версия попала к пользователям? Я думаю пользователи будут разочарованы.</p>

<p>Чтобы не быть голословным приведу пример (<a href="http://www.microsoft.com/sqlserver">MS SQL Server</a>):</p>

<ol><li><p>тестовый скрипт. <script src="https://gist.github.com/2061572.js?file=gistfile1.sql"></script></p></li>
<li><p>вывод в консоль. <script src="https://gist.github.com/2061572.js?file=output.txt"></script></p></li>
</ol><p>Обратите внимание, что процедура <code>sp_rename</code> только предупреждает, что что-то может сломаться, но не говорит что именно. А если я просто вручную удалю колонку? Я об этом никогда не узнаю.</p>

<p>Таким образом при использовании хранимых процедур мне необходимо держать в голове все зависимости между всеми объектами в базе данных и как можно быстрее распространять и актуализировать эти знания между членами команды, включая новобранцев. У последних, IMO, голова просто лопнет от переизбытка информации.</p></li>
<li><p>Хранимые процедуры отделены от клиентского кода, который их вызывает.</p>

<p>Если хранимая процедура была удалена, или переименована, или просто изменились её параметры об ошибках я узнаю только в момент попытки ее выполнения. Обычно хранимые процедуры используются в качестве средства устранения дублирования кода и, как следствие, вызываются разными клиентами. Т.е. в дополнение ко всем связям между объектами мне необходимо держать в голове информацию о всех клиентах и всех хранимых процедурах, которых они вызывают. В общем случае это ведет к тем же последствиям, что и в пункте 1.</p>

<p>Для того, чтобы посмотреть как ведет себя хранимая процедура, ее код, найти подходящую процедуру и т.п. мне необходимо открыть IDE для моей любимой RDBMS. Т.е. переключить контекст своего внимания. Иногда, когда я таким образом отвлекаюсь я очень долго не могу вернуться к работе.</p></li>
<li><p>Хранимые процедуры не переносимы между различными типами RDBMS.</p>

<p>Вы конечно можете сказать, что это чушь и, от части, будете правы, но только в том случае если вы делает корпоративный или уникальный продукт под заказ.</p>

<p>Но, очень часто продуктовые компании, разрабатывающие коробочные или близкие к ним кастомизируемые тиражируемые решения, попадают в зависимость от требования клиента: &#8220;Ваш продукт хорош, но он использует <a href="http://www.oracle.com/us/products/database/index.html">Oracle</a>, а мы используем MS SQL и хотелось бы&#8230;.&#8221; В этом случае есть 2,5 возможных развития сюжета: вы говорите, что это не возможно и теряете клиента; вы говорите, что нужно подождать полгода (год, два, &#8230;) и клиент уходит; или остается и вы судорожно начинаете искать специалиста по MS SQL, переписывать ваши хранимые процедуры и так далее.</p>

<p>При последнем, самом оптимистичном варианте, вам нужно найти <em>дополнительных</em> людей, иначе вы просто не сможете развивать уже существующую систему. При этом вам будет необходимо как-то достигать согласованности работы обоих систем. Я знаю команды, которые для этого написали <strong>свой</strong> SQL-подобный язык и транслятор к нему в поддерживаемые системы.</p></li>
</ol><h4><a href="http://en.wikipedia.org/wiki/Object-Relational_Mapping">ORM</a></h4>

<p>"Минусы" ORM:</p>

<ol><li><p>ORM не всегда генерирует оптимальные запросы.
Да, это так. Но, большинство современных ORM предоставляют пользователям возможность переключиться на уровень ближе к базе данных, вплоть до написания запросов на SQL и использования хранимых процедур.</p>

<p>К примеру <a href="http://nhforge.org">NHibernate</a>, которую я считаю лучшей, предоставляет следующие возможности для написания запросов:</p>

<ol><li><a href="http://en.wikipedia.org/wiki/LINQ">LINQ</a> - самый высокоуровневый объектный подход к написанию запросов.</li>
<li><a href="http://nhforge.org/doc/nh/en/index.html#querycriteria">CriteriaAPI</a> или <a href="http://nhforge.org/doc/nh/en/index.html#queryqueryover">QueryOver</a> - объектный, но SQL-ориентированный подход.</li>
<li><a href="http://nhforge.org/doc/nh/en/index.html#queryhql">HQL</a> - hibernate query language - SQL-подобный язык для написания запросов.</li>
<li><a href="http://nhforge.org/doc/nh/en/index.html#querysql">SQL</a> - &#8220;голый&#8221; SQL</li>
<li><a href="http://nhforge.org/doc/nh/en/index.html#sp_query">Хранимые процедуры</a>.</li>
</ol><p>Также могу сказать, что кривость и неоптимальность запроса почти всегда напрямую зависит от кривости рук разработчика.</p></li>
<li><p>ORM тратит время на трансляцию запросов в SQL
Да, но: это время не такое уж и большое; большинство ORM транслирует запрос в SQL только при первом выполнении запроса, затем они его кэшируют.</p></li>
<li><p>ORM - большие страшные монстры, для маленьких проектов, как &#8220;из пушки по воробьям&#8221;</p>

<p>На это могу возразить то, что существует множество мелких ORM. Так же можно использовать ORM напрямую и не заботится ни о каких DDD и прочих монструозных технологиях. К примеру, использование NHibernate + <a href="http://fluentnhibernate.org/">FluentNHibernate</a> (<a href="http://wiki.fluentnhibernate.org/Auto_mapping">автомаппинг</a>) требует от разработчика написания 2х классов: 1. Конифигурацию NH; 2. Конфигурацию автомапинга. Причем эти классы могут быть практически без изменения кочевать из проекта в проект.</p></li>
</ol><p>Плюсы ORM для меня (в порядке появления в голове):</p>

<ol><li><p>ORM обеспечивает контроль целостности схемы данных</p></li>
<li><p>ОРМ позволяет работать с данными как с объектами. При этом обеспечивается контроль типов.</p></li>
<li><p>Некоторые ORM (EF, LLBLGen Pro) позволяют генерировать строго-типизированные обвертки, для вызова хранимых процедур.</p></li>
<li><p>Мне не нужно писать никакого кода на страшном ADO.NET.</p></li>
<li><p>Большинство ORM поддерживает несколько типов баз данных.</p></li>
</ol><p>Применительно к NHibernate:</p>

<ol><li><p>NHibernate поддерживает <a href="http://ayende.com/blog/1686/batching-support-in-nhibernate">группировку запросов в пакеты</a> и таким образом уменьшается количество обращений к RDBMS</p></li>
<li><p>NHibernate поддерживает <a href="http://ayende.com/blog/3979/nhibernate-futures">отложенные запросы</a>, которые выполнятся только в момент первого обращения к результатам. При этом все отложенные невыполненные запросы выполнятся в одном пакете.</p></li>
<li><p><a href="http://nhibernate.hibernatingrhinos.com/28/first-and-second-level-caching-in-nhibernate">Second Level Cache</a> - очень мощный инструмент. В умелых руках, повышает производительность приложения в разы.</p></li>
</ol><h4>Заключение</h4>

<p>ORM это не инструмент для замены хранимых процедур и запросов, это инструмент, для их дополнения. Он позволяет писать меньше рутинного однообразного кода - он уже написан за вас. Этот код <em>уже</em> протестирован множеством разработчиков на различных типах проектов. от мельчайших до сверх-гигантских.</p>

<p>Если в вашем проекте требуется мощь хранимых процедур, или скриптов написанных на SQL, то всегда используйте их <em>вместе</em> с, а не <em>вместо</em> ORM. Также я рекомендую пользоваться хранимыми процедурами только в исключительных ситуациях: только тогда, когда без них не обойтись.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://github.com/hazzik/blog.hazzik.ru/edit/master/_posts/tumblr/2011-10-09-web-requre-client-script-dependency-framework.html"><i class="fa fa-edit"></i></a>
      <a href="/2011/10/09/web-requre-client-script-dependency-framework/">
        Web.Requre - client script dependency framework
      </a>
    </h1>
    <ul class="post-info">
      <li><i class="fa fa-calendar"></i> 09 Oct 2011</li>
      <li><i class="fa fa-tags"></i> <a href="/tag/asp-dot-net-mvc" rel="tag">ASP.NET MVC</a>, <a href="/tag/requirejs" rel="tag">RequireJS</a>, <a href="/tag/headjs" rel="tag">HeadJS</a>, <a href="/tag/javasript" rel="tag">JavaSript</a>, <a href="/tag/resources" rel="tag">Resources</a> </li>
      <li><i class="fa fa-comments"></i> <a href="/2011/10/09/web-requre-client-script-dependency-framework/#disqus_thread" data-disqus-identifier="/2011/10/09/web-requre-client-script-dependency-framework/">0 комментариев</a></li>
    </ul>
    <div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><div dir="ltr" style="text-align: left;" trbidi="on"><h1>Что это?</h1><h1><span class="Apple-style-span" style="font-size: small; font-weight: normal;"><i>Web.Require</i> - небольшая библиотечка, для облегчения подключения скриптов в ваше Web-приложение.</span></h1><div><span class="Apple-style-span" style="font-size: small; font-weight: normal;"></span><br/><a name="more"></a></div><h1>Давай примеры!</h1><pre class="brush:html">&lt;head&gt;<br/>    &lt;title&gt;@ViewBag.Title&lt;/title&gt;<br/>    @Html.RequireStyleSheet(<br/>        Url.Content("~/Content/reset.css"),<br/>        Url.Content("~/Content/Site.less"),<br/>        Url.Content("~/Content/themes/base/minified/jquery.ui.all.min.css"))<br/><br/>    @Html.RequireScript(<br/>        Url.Content("~/Scripts/jquery-1.6.4.min.js"), <br/>        Url.Content("~/Scripts/jquery-ui-1.8.16.min.js"))<br/><br/>    @Html.OutputRequiredStyleSheets()<br/>    @Html.OutputRequiredScripts()<br/>&lt;/head&gt;<br/></pre><br/>Что тут происходит? Все очень просто: мы подключаем три css и два js файла. Что нам дает такой подход? Почему просто нельзя подключить скрипты в лоб?<br/><br/>Давайте представим, что какой-то контрол, например ваш кастомный диалог или, datepicker требует для своей работы отдельного скрпта? Как быть?<br/><ul style="text-align: left;"><li>Первый вариант - просто в контроле написать &lt;script src=&#8230;/&gt;. А если этот контрол на странице используется несколько раз?</li></ul><ul style="text-align: left;"><li>Второй вариант - просто включить этот скрипт в &lt;head&gt;. А если этот скрпит очень большой и прожорливый и используется не везде? </li></ul>Все очень просто: с помощью <i>Web.Require</i> совместим оба варианта и решим их проблемы: скрипт подгружается только один раз и только тогда, когда это необходимо. Например:<br/><br/></div><pre class="brush:csharp brush:html">&lt;!--DateTimePicker.cshtml--&gt;<br/>@Html.RequireScript(<br/>    Url.Content("~/Scripts/jquery-1.6.4.min.js"),<br/>    Url.Content("~/Scripts/jquery-ui-1.8.16.min.js"),<br/>    Url.Content("~/Scripts/jquery.ui.datepicker-ru.js"),<br/>    Url.Content("~/Scripts/DateTimePicker.js"))</pre>В итоге DateTimePicker.js добавиться в тэг  и наступит всеобщее счастье;)<br/><br/><h1>Как установить?</h1><div><span class="Apple-style-span" style="background-color: white; color: #333333; font-family: 'Segoe UI', Tahoma, 'Helvetica Neue', Arial, Helvetica, sans-serif; font-size: 12px; line-height: 12px;"></span><br/><div class="commandWrapper" style="background-attachment: initial; background-clip: initial; background-color: initial; background-image: -webkit-gradient(linear, 0 0, 0 100%, from(rgb(214, 214, 214)), to(rgb(80, 80, 80))); background-origin: initial; border-bottom-color: rgb(255, 255, 255); border-bottom-left-radius: 8px 8px; border-bottom-right-radius: 8px 8px; border-bottom-style: solid; border-bottom-width: 0px; border-color: initial; border-left-color: rgb(255, 255, 255); border-left-style: solid; border-left-width: 0px; border-right-color: rgb(255, 255, 255); border-right-style: solid; border-right-width: 0px; border-style: initial; border-top-color: rgb(255, 255, 255); border-top-left-radius: 8px 8px; border-top-right-radius: 8px 8px; border-top-style: solid; border-top-width: 0px; font-family: inherit; font-size: 12px; font-style: inherit; margin-bottom: 36px; margin-left: 0px; margin-right: 0px; margin-top: 36px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 4px; padding-left: 4px; padding-right: 4px; padding-top: 4px; vertical-align: baseline;"><div class="commandPrompt" style="-webkit-box-shadow: rgba(0, 0, 0, 0.59375) 6px 6px 14px inset, rgb(102, 102, 102) 1px 1px 4px; background-attachment: initial; background-clip: initial; background-color: initial; background-image: -webkit-gradient(linear, 0 0, 0 100%, from(rgb(94, 94, 94)), to(rgb(0, 0, 0))); background-origin: initial; border-bottom-color: rgb(196, 196, 196); border-bottom-left-radius: 6px 6px; border-bottom-right-radius: 6px 6px; border-bottom-style: solid; border-bottom-width: 1px; border-color: initial; border-left-color: rgb(196, 196, 196); border-left-style: solid; border-left-width: 1px; border-right-color: rgb(196, 196, 196); border-right-style: solid; border-right-width: 1px; border-style: initial; border-top-color: rgb(196, 196, 196); border-top-left-radius: 6px 6px; border-top-right-radius: 6px 6px; border-top-style: solid; border-top-width: 1px; box-shadow: rgba(0, 0, 0, 0.59375) 6px 6px 14px inset, rgb(102, 102, 102) 1px 1px 4px; font-family: inherit; font-size: 12px; font-style: inherit; margin-bottom: 0px; margin-left: 0px; margin-right: 0px; margin-top: 0px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; text-shadow: rgb(0, 0, 0) 1px 1px 1px; vertical-align: baseline;"><div class="command" style="border-bottom-width: 0px; border-color: initial; border-left-width: 0px; border-right-width: 0px; border-style: initial; border-top-width: 0px; color: #e2e2e2; font-family: Consolas, 'Andale Mono WT', 'Andale Mono', 'Lucida Console', 'Lucida Sans Typewriter', 'DejaVu Sans Mono', 'Bitstream Vera Sans Mono', 'Liberation Mono', 'Nimbus Mono L', Monaco, 'Courier New', Courier, monospace; font-size: 24px; font-style: inherit; line-height: 24px; margin-bottom: 24px; margin-left: 8px; margin-right: 8px; margin-top: 24px; outline-color: initial; outline-style: initial; outline-width: 0px; padding-bottom: 0px; padding-left: 0px; padding-right: 0px; padding-top: 0px; vertical-align: baseline;">PM&gt; Install-Package Web.Require</div><br/><div></div></div></div></div></div><h1>P.S.</h1>В будущем ожидаются следующие фишки:<br/><br/><ul style="text-align: left;"><li>Асинхронное подключение js</li><li>Конкатенация и минификация js и css + кэширование</li></ul><h1>P.P.S.</h1><div>Пример использования можно посмотреть <a href="https://github.com/hazzik/beerconf-website/">здесь</a></div></div><div class="blogger-post-footer"><img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/1624027437398699573-3477034535813804388?l=hazzik.blogspot.com" alt=""/></div>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://github.com/hazzik/blog.hazzik.ru/edit/master/_posts/tumblr/2011-08-24-mvcextensions-bootstrapping.html"><i class="fa fa-edit"></i></a>
      <a href="/2011/08/24/mvcextensions-bootstrapping/">
        MvcExtensions: bootstrapping
      </a>
    </h1>
    <ul class="post-info">
      <li><i class="fa fa-calendar"></i> 24 Aug 2011</li>
      <li><i class="fa fa-tags"></i> <a href="/tag/asp-dot-net-mvc" rel="tag">asp.net mvc</a>, <a href="/tag/mvcextensions" rel="tag">mvcextensions</a> </li>
      <li><i class="fa fa-comments"></i> <a href="/2011/08/24/mvcextensions-bootstrapping/#disqus_thread" data-disqus-identifier="/2011/08/24/mvcextensions-bootstrapping/">0 комментариев</a></li>
    </ul>
    <p>Как я уже <a href="/2011/08/20/mvcextensions-intro/">писал во введении</a>, весь код, выполняющийся при старте приложения необходимо помещать в, BootstrapperTask.</p>

<h1>Bootstrapper tasks</h1>

<p>В MvcExtensions для размещения кода, выполняющегося при запуске приложения существует понятие <a href="http://en.wikipedia.org/wiki/Bootstrapping_(computing)">Bootstrapper</a>, которому можно назначать задачи.</p>

<!-- more -->

<p>Назначение задачи происходит следующим образом:</p>

<pre><code>//Global.asax.cs
public class MvcApplication : WindsorMvcApplication {
    public MvcApplication() {
        Bootstrapper.BootstrapperTasks
            .Include&lt;RegisterControllers&gt;(); // задача, для регистрации контроллеров в IoC контейнер.
        }
    }
</code></pre>

<p>Кроме стандартной задачи для регистрации контроллеров существует еще несколько стандартных задач, которые подключают дополнительные возможности. Также есть несколько базовых классов, которые позволяют выполняет такие полезные действия, как регистрация маршрутов, фильтров, модел-байндеров, etc.</p>

<h2>Регистрация маршрутов</h2>

<p>Для регистрации маршрутов вам необходимо унаследоваться от абстрактного класса <em>RegisterRoutesBase</em>, и подключить задачу к bootstrapper.</p>

<pre><code>public class RegisterRoutes : RegisterRoutesBase {
    public RegisterRoutes(RouteCollection routes) 
        : base(routes) { }

    protected override void Register() {
        Routes.IgnoreRoute("favicon.ico");
        Routes.IgnoreRoute("{resource}.axd/{*pathInfo}");
        Routes.MapRoute("Default",
            "{controller}/{action}/{id}",
            new { controller = "Home", action = "Index", id = UrlParameter.Optional });
    }
}
</code></pre>

<h2>Конфигурация фильтров</h2>

<p>Еще одной интересной возможностью MvcExtensions является возможность добавлять фильтры (IMvcFilter) к действиям контроллеров динамически. Этот подход позволяет писать фильтры не через атрибуты, а как обычные классы, при этом появляется возможность использовать инжекцию зависимостей через конструктор. Для регистрации фильтров необходимо унаследоваться от базового абстрактного класса <em>ConfigureFiltersBase</em>.</p>

<p>Рассмотрим небольшой пример:</p>

<pre><code>public class ConfigureFilters : ConfigureFiltersBase { 
    public ConfigureFilters(IFilterRegistry registry) 
        : base(registry) { }


    protected override void Configure() {
        Registry.Register&lt;ProductController, PopulateCategories, PopulateSuppliers&gt;(c =&gt; c.Create())
                .Register&lt;ProductController, PopulateCategories, PopulateSuppliers&gt;(c =&gt; c.Edit(0));
    }
}
</code></pre>

<p>Как видно из примера, для контроллера <em>ProductController</em> для действий <em>Create</em> и <em>Edit</em> регистрируются два фильтра <em>PopulateCategories</em> и <em>PopulateSuppliers</em></p>

<h2>Регистрация ModelBinder</h2>

<p>В жизни бывает всякое и иногда необходимо написать свой ModelBinder, с помощью <em>ConfigureModelBindersBase</em> вы можете привязать свой ModelBinder к модели.</p>

<pre><code>public class ConfigureModelBinders : ConfigureModelBindersBase { 
    public ConfigureModelBinders(TypeMappingRegistry&lt;object, IModelBinder&gt; registry)
        : base(registry) { }

    protected override void Configure() {
        Registry.Register&lt;ProductEditModel, ProductEditModelBinder&gt;();
    }
} 
</code></pre>

<p>Здесь вроде все понятно.</p>

<h2>Собственные Bootstrapper tasks</h2>

<p>Нет ничего проще, чем создать собственные задачи: необходимо просто  унаследоваться от базового класса <em>BootstrapperTask</em>. Также задачи могут зависеть от других задач, для этого вашу задачу нужно пометить атрибутом [DependsOn]. И главное: н<em>е забудьте зарегистрировать свои задачи в бутстрапер.</em></p>

<pre><code>[DependsOn(typeof(RegisterRoutes))]
public class ConfigureFiltersBase : BootstrapperTask {
    protected override void Configure() {
        // Ваш код будет здесь
    }
}
</code></pre>

<h1>Вместо заключения</h1>

<p>На сегодня все. В следующей статье я планирую подробно рассмотреть конфигурацию метаданых.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://github.com/hazzik/blog.hazzik.ru/edit/master/_posts/tumblr/2011-08-20-mvcextensions-intro.html"><i class="fa fa-edit"></i></a>
      <a href="/2011/08/20/mvcextensions-intro/">
        MvcExtensions: введение
      </a>
    </h1>
    <ul class="post-info">
      <li><i class="fa fa-calendar"></i> 20 Aug 2011</li>
      <li><i class="fa fa-tags"></i> <a href="/tag/asp-dot-net-mvc" rel="tag">asp.net mvc</a>, <a href="/tag/mvcextensions" rel="tag">mvcextensions</a> </li>
      <li><i class="fa fa-comments"></i> <a href="/2011/08/20/mvcextensions-intro/#disqus_thread" data-disqus-identifier="/2011/08/20/mvcextensions-intro/">0 комментариев</a></li>
    </ul>
    <p><a href="http://mvcextensions.codeplex.com/">MvcExtensions</a> - это библиотека расширений для ASP.NET MVC. Библиотека предоставляет пользователю мощнейший инструмент для конфигурирования метаданных для ASP.NET MVC посредством fluent-интерфейса. Второй важной особенностью библиотеки является возведение использования IoC контейнера в абсолют (Можно инжектировать данные даже в атрибуты).<!-- more --></p>

<h1>С чего начать?</h1>

<p>Для начала вам необходимо определится с IoC контейнером, который вы хотите использовать - в MvcExtensions есть адаптеры для следующих популярных IoC контейнеров: <a href="http://www.castleproject.org/container/">Castle.Windsor</a>, <a href="http://unity.codeplex.com/">Unity</a>, <a href="http://ninject.org/">Ninject</a>, <a href="http://structuremap.net/structuremap/">StructureMap</a>. Для этого вам необходимо установить соответствующую версию адаптера через nuget: <a href="http://nuget.org/List/Packages/mvcextensions.windsor">Castle.Windsor</a>, <a href="http://nuget.org/List/Packages/mvcextensions.unity">Unity</a>, <a href="http://nuget.org/List/Packages/mvcextensions.ninject">Ninject</a>, <a href="http://nuget.org/List/Packages/mvcextensions.structuremap">StructureMap</a>.</p>

<p>Затем вам необходимо унаследовать класс своего приложения от базового приложения для выбранного адаптера, например, <code>MvcExtensions.Windsor.WindsorMvcApplication</code>:</p>

<pre><code>    //Global.asax.cs
    public class MvcApplication : WindsorMvcApplication {
        public MvcApplication() {
        }
    }
</code></pre>

<p><em><strong>UPD</strong> По умолчанию в HttpAppication в качестве бутсраппер-методов создаются методы <code>Application_Start</code> и <code>Application_End</code>. MvcExtensions предоставляет альтернативные методы для этого <code>OnStart</code> и <code>OnEnd</code>. Необходимо использовать их, иначе код в метода <code>Application_Start</code> и <code>Application_End</code> <strong>не будет</strong> вызван.</em></p>

<h1>Инициализируем IoC контейнер</h1>

<p>Для инициализации вашего любимого IoC контейнера вам необходимо просто реализовать соответствующий интерфейс или унаследоваться от базового класса: <code>IWindsorInstaller</code>, <code>Ninject.Modules.NinjectModule</code>, <code>StructureMap.Configuration.DSL.Registry</code>, <code>Microsoft.Practices.Unity.IModule</code>. Например для Windosor:</p>

<pre><code>    public class AccountInstaller : IWindsorInstaller {
        public void Install(IWindsorContainer container, IConfigurationStore store) {
            var registration = Component.For&lt;IAuthenticationService&gt;()
                .ImplementedBy&lt;FormsAuthenticationService&gt;()
                .LifeStyle.Transient;

            container.Register(registration);
        }
    }
</code></pre>

<p>Полученные таким образом классы нужно положить в ваше MVC приложение в любую папку, я рекомендую в /Infrastructure. <em>Необходимо запомнить, что контроллеры таким образом инициализировать не требуется!</em>.</p>

<h1>Регистрация контроллеров</h1>

<p>В MvcExtensions весь код, выполняющийся при старте приложения необходимо помещать в, так называемые, <code>BootstrapperTask</code>. Существуют некоторые стандартные таски, такие как например регистрация контроллеров. Для того, чтобы проинструктировать MvcExtensions, что вы хотите зарегистрировать свои контроллеры, необходимо всего-лишь включить задачу <code>RegisterControllers</code> в последовательность задач, выполняемых при старте:</p>

<pre><code>    //Global.asax.cs
    public class MvcApplication : WindsorMvcApplication {
        public MvcApplication() {
            Bootstrapper.BootstrapperTasks
                .Include&lt;RegisterControllers&gt;();
        }
    }
</code></pre>

<p>После этого все контроллеры в вашем MVC приложении будут создаваться с помощью IoC контейнера.</p>

<h1>Метаданные</h1>

<p>MvcExtensions предлагает пользователям замену стандартному способу конфигурирования метеданных через DataAnnotations, посредством fluent-интерфейса для конфигурирования. Этот подход обладает феноменальной гибкостью и неограниченными возможностями для расширения.</p>

<p>Для того, чтобы использовать эту возможность в MvcExtensions необходимо также зарегистрировать ее:</p>

<pre><code>    //Global.asax.cs
    public class MvcApplication : WindsorMvcApplication {
        public MvcApplication() {
            Bootstrapper.BootstrapperTasks
                .Include&lt;RegisterControllers&gt;()
                .Include&lt;RegisterModelMetadata&gt;();
        }
    }
</code></pre>

<p>Затем необходимо написать конфигурацию для ваших форм и моделей отображения:</p>

<pre><code>    public class SignUpMetadata : ModelMetadataConfiguration {
        public SignUpMetadata() {
            Configure(x =&gt; x.Login)
                .DisplayName("Имя пользователя")
                .Required("Необходимо указать имя пользователя");

            Configure(x =&gt; x.Email)
                .DisplayName("Адрес электронной почты")
                .Required("Необходимоуказать адрес электронной почты")
                .AsEmail();

            Configure(x =&gt; x.Password)
                .DisplayName("Пароль")
                .Required("Необходимо указать пароль")
                .MinimumLength(6, " Длина пароля должна быть не меньше 6 символов")
                .AsPassword();

            Configure(x =&gt; x.ConfirmPassword)
                .DisplayName("Пароль еще раз")
                .Required("Необходимо указать подтверждение пароля")
                .AsPassword()
                .Compare("Password", "Пароль и подвтерждение пароля должны совпадать");
        }
    }
</code></pre>

<h1>Заключение</h1>

<p>На этом первый этап конфигурирования MvcExtensions завершен. Если что-то осталось непонятно - задавайте вопросы, буду стараться разъяснять.</p>

  </div>
  
  <div class="post">
    <h1 class="post-title">
      <a href="http://github.com/hazzik/blog.hazzik.ru/edit/master/_posts/tumblr/2010-05-23-ddd-business-rules-2.html"><i class="fa fa-edit"></i></a>
      <a href="/2010/05/23/ddd-business-rules-2/">
        Бизнес-правила в DDD-2
      </a>
    </h1>
    <ul class="post-info">
      <li><i class="fa fa-calendar"></i> 23 May 2010</li>
      <li><i class="fa fa-tags"></i> <a href="/tag/questions" rel="tag">questions</a>, <a href="/tag/business-rules" rel="tag">business rules</a>, <a href="/tag/ddd" rel="tag">DDD</a>, <a href="/tag/voprosy" rel="tag">Вопросы</a> </li>
      <li><i class="fa fa-comments"></i> <a href="/2010/05/23/ddd-business-rules-2/#disqus_thread" data-disqus-identifier="/2010/05/23/ddd-business-rules-2/">0 комментариев</a></li>
    </ul>
    <p>Продолжу мучить сообщество своими вопросами по DDD дальше. <br/><br/>Допустим, мы хотим добавить в систему идентификацию не только <a href="http://blog.hazzik.ru/2010/05/ddd.html">по адресу электронной почты</a>, но и по имени пользователя. В связи с этим у нас в системе возникает другое бизнес-правило:<br/><br/><i>Имя пользователя является уникальным</i><br/><br/>Это бизнес правило фигурирует в следующих историях использования:<br/><br/></p>

<ol><li>Пользователь регистрируется в системе, если уже есть другой пользователь с таким именем, то пользователю выводиться сообщение об ошибке.</li><li>Пользователь может изменить свое имя, если уже есть другой пользователь с таким именем, то пользователю выводиться сообщение об ошибке.</li></ol><p><br/>Где должна находиться реализация данного бизнес-правила?<br/><br/>Жду ваших ответов с примерами кода в комментариях.</p>

<div class="blogger-post-footer"><img width="1" height="1" src="https://blogger.googleusercontent.com/tracker/1624027437398699573-6948422760771478543?l=hazzik.blogspot.com" alt=""/></div>

  </div>
  
</div>

<div class="pagination">
  
    <a class="pagination-item older" href="/page5">Позднее</a>
  
  
    
      <a class="pagination-item newer" href="/page3">Раньше</a>
    
  
</div>

    </div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'blog-hazzik-ru'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<!-- Yandex.Metrika counter -->
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script>
<script type="text/javascript">
try { var yaCounter13173247 = new Ya.Metrika({id:13173247,
          webvisor:true,
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true});
} catch(e) { }
</script>
<noscript><div><img src="//mc.yandex.ru/watch/13173247" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

  </body>
</html>
