<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
  <meta charset="utf-8" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="description" content="" />
  <meta name='yandex-verification' content='7254b866679e5872' />

  <title>
    
      MvcExtensions: bootstrapping &middot; Hazzik's blog
    
  </title>

  <link href="http://gmpg.org/xfn/11" rel="profile">
  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link rel="stylesheet" href="/public/css/hyde.css">
  <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-144-precomposed.png">
                                 <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body>

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="tag-cloud">
      <a href="/tag/dot-net" class="set-4">.NET</a> <a href="/tag/dot-net-3-dot-5" class="set-1">.NET 3.5</a> <a href="/tag/dot-netconf" class="set-1">.netconf</a> <a href="/tag/best-practicies" class="set-1">Best Practicies</a> <a href="/tag/blog" class="set-1">Blog</a> <a href="/tag/connascence" class="set-1">Connascence</a> <a href="/tag/db" class="set-2">DB</a> <a href="/tag/ddd" class="set-1">DDD</a> <a href="/tag/dropdown" class="set-1">DropDown</a> <a href="/tag/entityframework" class="set-1">EntityFramework</a> <a href="/tag/git" class="set-1">Git</a> <a href="/tag/headjs" class="set-1">HeadJS</a> <a href="/tag/holly-war" class="set-1">Holly War</a> <a href="/tag/javasript" class="set-1">JavaSript</a> <a href="/tag/orm" class="set-1">ORM</a> <a href="/tag/oracle" class="set-1">Oracle</a> <a href="/tag/phpunit" class="set-1">PHPUnit</a> <a href="/tag/performance" class="set-1">Performance</a> <a href="/tag/postgresql" class="set-1">PostgreSQL</a> <a href="/tag/principles" class="set-1">Principles</a> <a href="/tag/requirejs" class="set-1">RequireJS</a> <a href="/tag/resources" class="set-1">Resources</a> <a href="/tag/seo" class="set-1">SEO</a> <a href="/tag/sockets" class="set-1">Sockets</a> <a href="/tag/software-design-metrics" class="set-1">Software Design Metrics</a> <a href="/tag/subversion" class="set-1">Subversion</a> <a href="/tag/tree-like-structures" class="set-1">Tree-like structures</a> <a href="/tag/version-control" class="set-1">Version Control</a> <a href="/tag/asp-dot-net" class="set-2">asp.net</a> <a href="/tag/asp-dot-net-mvc" class="set-5">asp.net mvc</a> <a href="/tag/bootstrapping" class="set-1">bootstrapping</a> <a href="/tag/business-rules" class="set-1">business rules</a> <a href="/tag/datepicker" class="set-1">datepicker</a> <a href="/tag/dotnetconf" class="set-1">dotnetconf</a> <a href="/tag/google-sitemap" class="set-1">google sitemap</a> <a href="/tag/jquery-ui" class="set-1">jquery-ui</a> <a href="/tag/lambda-expression" class="set-1">lambda expression</a> <a href="/tag/linq" class="set-1">linq</a> <a href="/tag/llblgen" class="set-1">llblgen</a> <a href="/tag/msil" class="set-1">msil</a> <a href="/tag/mvc" class="set-1">mvc</a> <a href="/tag/mvcextensions" class="set-4">mvcextensions</a> <a href="/tag/network" class="set-1">network</a> <a href="/tag/nhibernate" class="set-3">nhibernate</a> <a href="/tag/phalanger" class="set-1">phalanger</a> <a href="/tag/php" class="set-1">php</a> <a href="/tag/questions" class="set-1">questions</a> <a href="/tag/reflection" class="set-1">reflection</a> <a href="/tag/silverlight" class="set-1">silverlight</a> <a href="/tag/sitemap-dot-xml" class="set-1">sitemap.xml</a> <a href="/tag/xunit" class="set-1">xUnit</a> <a href="/tag/asinkhronnyi-vvod-vyvod" class="set-1">Асинхронный ввод-вывод</a> <a href="/tag/voprosy" class="set-2">Вопросы</a> <a href="/tag/razrabotka" class="set-1">Разработка</a> <a href="/tag/khranimyie-protsiedury" class="set-1">Хранимые процедуры</a> <a href="/tag/dlia-siebia" class="set-1">для себя</a> <a href="/tag/poiskovaia-optimizatsiia" class="set-1">поисковая оптимизация</a>
    </div>
    <div class="sidebar-about">

      <h1>
        <a href="/" rel="home">Hazzik's blog</a>
      </h1>
      <p class="lead">
        <a href="/" rel="home"></a>
      </p>
    </div>

    <ul class="sidebar-nav">
      <li class="sidebar-nav-item">
        <a href="/" rel="home">Главная</a>
      </li>

      

      
      
            <li class="sidebar-nav-item">
              <a href="/about/">Обо мне</a>
            </li>
      
    </ul>
    <ul class="sidebar-social">
      <li class="sidebar-social-item"><a href="http://twitter.com/hazzik" rel="me"><i class="fa fa-twitter"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://github.com/hazzik" rel="me"><i class="fa fa-github"></i></a></li>
      &middot;
      <li class="sidebar-social-item"><a href="http://linkedin.com/in/hazzik" rel="me"><i class="fa fa-linkedin"></i></a></li>
    </ul>

    <p>&copy; 2014. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="post hentry">
  <h1 class="post-title entry-title">
    <a href="http://github.com/hazzik/blog.hazzik.ru/edit/master/_posts/tumblr/2011-08-24-mvcextensions-bootstrapping.html"><i class="fa fa-edit"></i></a> MvcExtensions: bootstrapping
  </h1>
  <ul class="post-info">
    <li><i class="fa fa-calendar"></i><time datetime="2011-08-24T13:52:00+12:00" class="published"> 24 Aug 2011 </time></li>
    <li class="tags"><i class="fa fa-tags"></i> <a href="/tag/asp-dot-net-mvc" rel="tag">asp.net mvc</a>, <a href="/tag/mvcextensions" rel="tag">mvcextensions</a></li>
    <li><i class="fa fa-comments"></i> <a href="/2011/08/24/mvcextensions-bootstrapping/#disqus_thread" data-disqus-identifier="/2011/08/24/mvcextensions-bootstrapping/">0 комментариев</a></li>
  </ul>
  <div class="entry-content">
    <p>Как я уже <a href="/2011/08/20/mvcextensions-intro/">писал во введении</a>, весь код, выполняющийся при старте приложения необходимо помещать в, BootstrapperTask.</p>

<h1>Bootstrapper tasks</h1>

<p>В MvcExtensions для размещения кода, выполняющегося при запуске приложения существует понятие <a href="http://en.wikipedia.org/wiki/Bootstrapping_(computing)">Bootstrapper</a>, которому можно назначать задачи.</p>

<!-- more -->

<p>Назначение задачи происходит следующим образом:</p>

<pre><code>//Global.asax.cs
public class MvcApplication : WindsorMvcApplication {
    public MvcApplication() {
        Bootstrapper.BootstrapperTasks
            .Include&lt;RegisterControllers&gt;(); // задача, для регистрации контроллеров в IoC контейнер.
        }
    }
</code></pre>

<p>Кроме стандартной задачи для регистрации контроллеров существует еще несколько стандартных задач, которые подключают дополнительные возможности. Также есть несколько базовых классов, которые позволяют выполняет такие полезные действия, как регистрация маршрутов, фильтров, модел-байндеров, etc.</p>

<h2>Регистрация маршрутов</h2>

<p>Для регистрации маршрутов вам необходимо унаследоваться от абстрактного класса <em>RegisterRoutesBase</em>, и подключить задачу к bootstrapper.</p>

<pre><code>public class RegisterRoutes : RegisterRoutesBase {
    public RegisterRoutes(RouteCollection routes) 
        : base(routes) { }

    protected override void Register() {
        Routes.IgnoreRoute("favicon.ico");
        Routes.IgnoreRoute("{resource}.axd/{*pathInfo}");
        Routes.MapRoute("Default",
            "{controller}/{action}/{id}",
            new { controller = "Home", action = "Index", id = UrlParameter.Optional });
    }
}
</code></pre>

<h2>Конфигурация фильтров</h2>

<p>Еще одной интересной возможностью MvcExtensions является возможность добавлять фильтры (IMvcFilter) к действиям контроллеров динамически. Этот подход позволяет писать фильтры не через атрибуты, а как обычные классы, при этом появляется возможность использовать инжекцию зависимостей через конструктор. Для регистрации фильтров необходимо унаследоваться от базового абстрактного класса <em>ConfigureFiltersBase</em>.</p>

<p>Рассмотрим небольшой пример:</p>

<pre><code>public class ConfigureFilters : ConfigureFiltersBase { 
    public ConfigureFilters(IFilterRegistry registry) 
        : base(registry) { }


    protected override void Configure() {
        Registry.Register&lt;ProductController, PopulateCategories, PopulateSuppliers&gt;(c =&gt; c.Create())
                .Register&lt;ProductController, PopulateCategories, PopulateSuppliers&gt;(c =&gt; c.Edit(0));
    }
}
</code></pre>

<p>Как видно из примера, для контроллера <em>ProductController</em> для действий <em>Create</em> и <em>Edit</em> регистрируются два фильтра <em>PopulateCategories</em> и <em>PopulateSuppliers</em></p>

<h2>Регистрация ModelBinder</h2>

<p>В жизни бывает всякое и иногда необходимо написать свой ModelBinder, с помощью <em>ConfigureModelBindersBase</em> вы можете привязать свой ModelBinder к модели.</p>

<pre><code>public class ConfigureModelBinders : ConfigureModelBindersBase { 
    public ConfigureModelBinders(TypeMappingRegistry&lt;object, IModelBinder&gt; registry)
        : base(registry) { }

    protected override void Configure() {
        Registry.Register&lt;ProductEditModel, ProductEditModelBinder&gt;();
    }
} 
</code></pre>

<p>Здесь вроде все понятно.</p>

<h2>Собственные Bootstrapper tasks</h2>

<p>Нет ничего проще, чем создать собственные задачи: необходимо просто  унаследоваться от базового класса <em>BootstrapperTask</em>. Также задачи могут зависеть от других задач, для этого вашу задачу нужно пометить атрибутом [DependsOn]. И главное: н<em>е забудьте зарегистрировать свои задачи в бутстрапер.</em></p>

<pre><code>[DependsOn(typeof(RegisterRoutes))]
public class ConfigureFiltersBase : BootstrapperTask {
    protected override void Configure() {
        // Ваш код будет здесь
    }
}
</code></pre>

<h1>Вместо заключения</h1>

<p>На сегодня все. В следующей статье я планирую подробно рассмотреть конфигурацию метаданых.</p>

  </div>
</div>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- blog.hazzik.ru -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:15px"
     data-ad-client="ca-pub-6286543550478332"
     data-ad-slot="3089658242"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script>

  <div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'blog-hazzik-ru'; // required: replace example with your forum shortname
      var disqus_identifier = '/2011/08/24/mvcextensions-bootstrapping/';
      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/2014/09/17/git-plus-plink/">
            msysGit + Plink
            <small>17 Sep 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/07/04/connascence/">
            Connascence
            <small>04 Jul 2014</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/2014/05/28/the-blog-has-been-moved-to-jekyll/">
            Блог переехал на Jekyll и GitHub Pages
            <small>28 May 2014</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

    </div>
<script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'blog-hazzik-ru'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<!-- Yandex.Metrika counter -->
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript"></script>
<script type="text/javascript">
try { var yaCounter13173247 = new Ya.Metrika({id:13173247,
          webvisor:true,
          clickmap:true,
          trackLinks:true,
          accurateTrackBounce:true});
} catch(e) { }
</script>
<noscript><div><img src="//mc.yandex.ru/watch/13173247" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

  </body>
</html>
